<html>
<head>
<style>
    .btn {
        width: 100px;
        height: 100px;
        cursor: pointer;
    }
    .show {
        background-color: #CCC;
    }
    .hide {
        background-color: #DDD;
    }
    .fullslidecanvas {
        background-color: #EEE;
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0px;
        left: 0px;
    }
</style>
</head>
<body>
<div class="btn show" onclick="firstRender('three-model-render-container');" >show</div>

<div class="btn hide" onclick="killFirstRender('three-model-render-container');" >hide</div>

<div style="width:898px;height:698px;position:relative;">
    <div id="three-model-render-container" class="fullslidecanvas">
      <canvas width="898" height="696"></canvas>
    </div>
</div>

<script src="three.min.js"></script>
<script src="ColladaLoader.js"></script>
<script>
//  function show3D() {
//      var loader = new THREE.ColladaLoader();
//      loader.load("sfeir.dae", function(collada) {
//          var model = collada.scene;
//          model.position=;
//          model.rotation=;
//          scene.add(model);
         
//      }, 
//      function progress(p) {
         
//      });
//  }
 
 function firstRender(id)
 {   
     // dimensions
     var canvascontainer = document.getElementById(id);
     // relaunch if not ready
     if (canvascontainer == null || canvascontainer.clientWidth == 0 || canvascontainer.clientHeight == 0 || canvascontainer.animation === -1) { window.setTimeout(function() {firstRender(id);}, 200); return; }
     
     // do nothing if already running
     if (canvascontainer.animation)
         return;
     else
         canvascontainer.animation = true;
     
     var width  = canvascontainer.clientWidth;
     var height = canvascontainer.clientHeight-2; // unfathomable bug: why do I get a scroll bar with the full height ???
     
     // renderer
     var renderer = new THREE.WebGLRenderer ({antialias: true});
     renderer.setSize(width, height);
     
     // glue to HTML element
     canvascontainer.appendChild(renderer.domElement);
     renderer.setClearColorHex(0x000000, 0);
     renderer.clear();
     
     // camera
     var camera = new THREE.PerspectiveCamera(35, width / height, 1, 3000);
     camera.position.z = 300;
     
     // scene
     var scene = new THREE.Scene();
     
     // lights
     var light1 = new THREE.DirectionalLight(0xffffff, 1);
     light1.position.set(1, 1, 0.3);
     scene.add(light1);
     
     var light2 = new THREE.DirectionalLight(0xffffff, 1);
     light2.position.set(-1, 1, -0.3);
     scene.add(light2);
     
     var light3 = new THREE.DirectionalLight(0xffffff, 0.7);
     light3.position.set(0.5, -0.5, 1);
     scene.add(light3);
     
     // textured cube
     switch (id)
     {
     
     case "three-model-render-container":
         firstLoadAndroid(scene);
         break;
     case "three-free-render-container":
         firstLoadAndroidTextured(scene);
         break;
     default:
         firstLoadCube(scene);
     }
     
     var t0 = new Date().getTime();
     
     var anim = function()
     {
         var t = new Date().getTime();
         // when the canvas dies, abort animation loop
         if (canvascontainer.animation)
         {
             scene.traverse(function(object)
             {
                 // models: slow rotation
                 if (object instanceof THREE.Object3D && object.name.indexOf("mymodel") >= 0)
                 {
                     object.rotation.y = (t-t0)/1000 - Math.PI/2;
                 };
             } );
         
             renderer.render(scene, camera);
             requestAnimationFrame(anim);
         }
     };
     requestAnimationFrame(anim);
 }

 function firstLoadAndroid(scene)
 {   
     var loader = new THREE.ColladaLoader();
     loader.options.convertUpAxis= true;
     loader.options.upAxis = 'Y';
     
     loader.load("sfeir.dae",
             function(collada)
             {
                 var scale = new THREE.Vector3(3,3,3);
                 var model = collada.scene;
                 model.position.z = 0;
                 model.position.y = -80;
                 model.scale.copy(scale);
                 //model.rotation.copy(rotation);
                 model.name = "mymodel-sfeir";
                 scene.add(model);
             } );
 }
 
 function killFirstRender(id)
 {
     var canvascontainer = document.getElementById(id);
     canvascontainer.animation = -1; // dying (set this wether the animation is running or not)
     window.setTimeout(function()
     {
         // signal death of this animation
         delete canvascontainer.animation;
         if (canvascontainer.firstChild !== null)
             canvascontainer.removeChild(canvascontainer.firstChild);
     }, 300);
 }
 
</script>
</body>
</html>
